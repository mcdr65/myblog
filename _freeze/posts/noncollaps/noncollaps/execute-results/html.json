{
  "hash": "2eaa38c82f7e0ebd4667667198a3a21f",
  "result": {
    "markdown": "---\ntitle: \"Noncollapsibility of the odds ratio\"\ndate: \"2023-12-02\"\ndescription: \"IPW-analysis\"\ncategories: [code, analysis]\n---\n\n\n\n\n\n\n\n# Noncollapsibility\n\nWe simulate data from GLM with **non-confounding** covariate $C$:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(3)\nN <- 400\nC <- sort(runif(N,-8,8)) #non-confounding C\nG<-sample(c(0,1),N,replace=TRUE)\nbeta0<-0\nbeta1<-log(10)\nbeta2<-1\n##Logistic \netai<-beta0+beta1*G+beta2*C\npii<-exp(etai)/(1+exp(etai))\nYdich <-rbinom(G,size=1,prob=pii)\ndat<-data.frame(C,G,Ydich)\ncor(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             C        G  Ydich\nC     1.000000 0.006606 0.8131\nG     0.006606 1.000000 0.1560\nYdich 0.813133 0.156035 1.0000\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodC<-glm(Ydich~G+C,family=\"binomial\")\nmodM<-glm(Ydich~G,family=\"binomial\")\n```\n:::\n\n\n\n\n## Illustrate non-collapsibility\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred<-predict(modM,type=\"response\",se.fit=TRUE)\npredgA<-predict(modC,newdata=data.frame(C=C[G==0],G=0),se.fit=TRUE,type=\"response\")\npredgB<-predict(modC,newdata=data.frame(C=C[G==1],G=1),se.fit=TRUE,type=\"response\")\nplot(C,Ydich,col=c(\"blue\",\"red\")[G+1],ylab=\"Probability\")\nlines(sort(C[G==0]),sort(predgA$fit),col=\"blue\")\nlines(sort(C[G==1]),sort(predgB$fit),col=\"red\")\nabline(a=mean(pii[G==0]),b=0,col=\"blue\",lty=2)\nabline(a=mean(pii[G==1]),b=0,col=\"red\",lty=2)\n```\n\n::: {.cell-output-display}\n![](noncollaps_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Marginal model\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(modM)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error z value Pr(>|z|)\n(Intercept) -0.08004     0.1415 -0.5655 0.571710\nG            0.63377     0.2040  3.1071 0.001889\n```\n:::\n:::\n\n\n## Conditional model\n\nEffect of $G$ is larger, even though $C$ is not a confounder. This is due to **non-collapsibility of the odds ratio**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(modC)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error z value  Pr(>|z|)\n(Intercept) -0.05395     0.3208 -0.1682 8.665e-01\nG            2.46270     0.5209  4.7280 2.267e-06\nC            1.04913     0.1200  8.7453 2.223e-18\n```\n:::\n:::\n\n\n\n## IPW-model\n\nEstimate inverse probability weights to fit marginal structural\n     models in a point treatment situation. \n\n\n### Weights\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ipw)\ntemp <- ipwpoint(exposure=G,family = \"binomial\",link = \"logit\",data=dat,numerator =~1,denominator = ~ C)\nsummary(temp$ipw.weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  0.989   0.994   1.000   1.000   1.006   1.012 \n```\n:::\n\n```{.r .cell-code}\ndat$sw<-temp$ipw.weights\n```\n:::\n\n\n### Marginal structural model\n\nMarginal structural model for the causal effect of $X$ on $Y$ corrected for confounding by $C$ using inverse probability weighting\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodW<-glm(Ydich~G,weights=sw,data=dat,family=quasibinomial)\nsummary(modW)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  -0.0683     0.1419 -0.4814 0.630474\nG             0.6117     0.2043  2.9938 0.002927\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(\"survey\")\nmsm <- (svyglm(Ydich ~ G, family=\"binomial\",design = svydesign(~ 1, weights =~sw,data = dat)))\nsummary(msm)\n```\n:::\n\n\n\n## Comparison\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary::modelsummary(models=list(\"marginal\"=modM,\"conditional\"=modC,\"IPW\"=modW))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> marginal </th>\n   <th style=\"text-align:center;\"> conditional </th>\n   <th style=\"text-align:center;\">  IPW </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> −0.080 </td>\n   <td style=\"text-align:center;\"> −0.054 </td>\n   <td style=\"text-align:center;\"> −0.068 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.142) </td>\n   <td style=\"text-align:center;\"> (0.321) </td>\n   <td style=\"text-align:center;\"> (0.142) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> G </td>\n   <td style=\"text-align:center;\"> 0.634 </td>\n   <td style=\"text-align:center;\"> 2.463 </td>\n   <td style=\"text-align:center;\"> 0.612 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.204) </td>\n   <td style=\"text-align:center;\"> (0.521) </td>\n   <td style=\"text-align:center;\"> (0.204) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 1.049 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (0.120) </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 400 </td>\n   <td style=\"text-align:center;\"> 400 </td>\n   <td style=\"text-align:center;\"> 400 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> AIC </td>\n   <td style=\"text-align:center;\"> 543.4 </td>\n   <td style=\"text-align:center;\"> 152.6 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BIC </td>\n   <td style=\"text-align:center;\"> 551.4 </td>\n   <td style=\"text-align:center;\"> 164.5 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Log.Lik. </td>\n   <td style=\"text-align:center;\"> −269.718 </td>\n   <td style=\"text-align:center;\"> −73.275 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:center;\"> 9.654 </td>\n   <td style=\"text-align:center;\"> 38.281 </td>\n   <td style=\"text-align:center;\"> 8.963 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 0.49 </td>\n   <td style=\"text-align:center;\"> 0.23 </td>\n   <td style=\"text-align:center;\"> 0.49 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n::: {.callout-important}\n* conditional-marginal=noncollaps+confouding\n* IPW-marginal=confounding\n* conditional-IPW=noncollaps\n:::\n\n\n\n\n# Example smoking and children weight\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(bwt)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t189 obs. of  9 variables:\n $ low     : int  0 0 0 0 0 0 0 0 0 0 ...\n $ age     : int  19 33 20 21 18 21 22 17 29 26 ...\n $ lwt     : int  182 155 105 108 107 124 118 103 123 113 ...\n $ smoke   : int  0 0 1 1 1 0 0 0 1 1 ...\n $ ht      : int  0 0 0 0 0 0 0 0 0 0 ...\n $ ui      : int  1 0 0 1 1 0 0 0 0 0 ...\n $ ftv     : int  0 3 1 2 0 0 1 1 1 0 ...\n $ bwt     : int  2523 2551 2557 2594 2600 2622 2637 2637 2663 2665 ...\n $ socclass: Factor w/ 3 levels \"I\",\"II\",\"III\": 2 3 1 1 1 3 1 3 1 1 ...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglm_smoke <- glm(low ~ smoke, data = bwt, family = binomial)\nsummary(glm_smoke)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error z value  Pr(>|z|)\n(Intercept)  -1.0871     0.2147  -5.062 4.142e-07\nsmoke         0.7041     0.3196   2.203 2.762e-02\n```\n:::\n\n```{.r .cell-code}\nglm_multi_1 <- glm(low ~ smoke + socclass, data = bwt, family = binomial)\nsummary(glm_multi_1)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error z value  Pr(>|z|)\n(Intercept)   -1.841     0.3529  -5.216 1.828e-07\nsmoke          1.116     0.3692   3.023 2.507e-03\nsocclassII     1.084     0.4900   2.212 2.693e-02\nsocclassIII    1.109     0.4003   2.769 5.618e-03\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp <- ipwpoint(exposure=smoke,family = \"binomial\",link = \"logit\",data=bwt,\n                 numerator=~1,denominator=~socclass)\nsummary(temp$ipw.weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  0.723   0.723   0.741   1.000   1.328   2.186 \n```\n:::\n\n```{.r .cell-code}\nbwt$sw<-temp$ipw.weights\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodW<-glm(low~smoke,weights=sw,data=bwt,family=quasibinomial)\nsummary(modW)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error t value  Pr(>|t|)\n(Intercept)   -1.277     0.2270  -5.625 6.696e-08\nsmoke          0.937     0.3283   2.854 4.798e-03\n```\n:::\n:::\n\n\n\n::: {.callout-important}\n* conditional-marginal=noncollaps+confouding\n* IPW-marginal=confounding\n* conditional-IPW=noncollaps\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary::modelsummary(models=list(\"marginal\"=glm_smoke,\"conditional\"=glm_multi_1,\"IPW\"=modW))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> marginal </th>\n   <th style=\"text-align:center;\"> conditional </th>\n   <th style=\"text-align:center;\">  IPW </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> −1.087 </td>\n   <td style=\"text-align:center;\"> −1.841 </td>\n   <td style=\"text-align:center;\"> −1.277 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.215) </td>\n   <td style=\"text-align:center;\"> (0.353) </td>\n   <td style=\"text-align:center;\"> (0.227) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> smoke </td>\n   <td style=\"text-align:center;\"> 0.704 </td>\n   <td style=\"text-align:center;\"> 1.116 </td>\n   <td style=\"text-align:center;\"> 0.937 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.320) </td>\n   <td style=\"text-align:center;\"> (0.369) </td>\n   <td style=\"text-align:center;\"> (0.328) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> socclassII </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 1.084 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.490) </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> socclassIII </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 1.109 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (0.400) </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 189 </td>\n   <td style=\"text-align:center;\"> 189 </td>\n   <td style=\"text-align:center;\"> 189 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> AIC </td>\n   <td style=\"text-align:center;\"> 233.8 </td>\n   <td style=\"text-align:center;\"> 228.0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BIC </td>\n   <td style=\"text-align:center;\"> 240.3 </td>\n   <td style=\"text-align:center;\"> 240.9 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Log.Lik. </td>\n   <td style=\"text-align:center;\"> −114.902 </td>\n   <td style=\"text-align:center;\"> −109.987 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:center;\"> 4.852 </td>\n   <td style=\"text-align:center;\"> 4.294 </td>\n   <td style=\"text-align:center;\"> 8.148 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 0.46 </td>\n   <td style=\"text-align:center;\"> 0.45 </td>\n   <td style=\"text-align:center;\"> 0.46 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n# Potential outcomes\nSee [Example](https://www.r-bloggers.com/2017/12/when-you-use-inverse-probability-weighting-for-estimation-what-are-the-weights-actually-doing/) for marginal structural models in this context.\n\n## Simulate some data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(simstudy)\n# define the data\ndefB <- defData(varname = \"L\", formula =0.27, \n                dist = \"binary\")\ndefB <- defData(defB, varname = \"Y0\", formula = \"-2.5 + 1.75*L\", \n                dist = \"binary\", link = \"logit\")\ndefB <- defData(defB, varname = \"Y1\", formula = \"-1.5 + 1.75*L\", \n                dist = \"binary\", link = \"logit\")\ndefB <- defData(defB, varname = \"A\", formula = \"0.315 + 0.352 * L\", \n                dist = \"binary\")\ndefB <- defData(defB, varname = \"Y\", formula = \"Y0 + A * (Y1 - Y0)\", \n                dist = \"nonrandom\")\ndefB\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   varname            formula variance      dist     link\n1:       L               0.27        0    binary identity\n2:      Y0      -2.5 + 1.75*L        0    binary    logit\n3:      Y1      -1.5 + 1.75*L        0    binary    logit\n4:       A  0.315 + 0.352 * L        0    binary identity\n5:       Y Y0 + A * (Y1 - Y0)        0 nonrandom identity\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2002)\nNnew<-1000\ndtB <- genData(Nnew, defB)\ndtB\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        id L Y0 Y1 A Y\n   1:    1 0  0  0 0 0\n   2:    2 0  0  1 0 0\n   3:    3 1  0  0 1 0\n   4:    4 0  0  0 0 0\n   5:    5 1  1  1 0 1\n  ---                 \n 996:  996 0  0  1 0 0\n 997:  997 0  0  0 1 0\n 998:  998 1  0  1 1 1\n 999:  999 0  0  0 0 0\n1000: 1000 1  0  0 1 0\n```\n:::\n:::\n\n\n## True causal effect (based on potential outcomes)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nodds <- function (p) {\n    return((p/(1 - p)))\n}\n\ndtB[, log( odds( mean(Y1) ) / odds( mean(Y0) ) )]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9494\n```\n:::\n:::\n\n\n## Conditional effect\n\nThe true conditional causal effect of $A$ is 1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc<-glm(Y ~ A + L , data = dtB, family=\"binomial\")\nmc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:  glm(formula = Y ~ A + L, family = \"binomial\", data = dtB)\n\nCoefficients:\n(Intercept)            A            L  \n      -2.74         1.21         1.61  \n\nDegrees of Freedom: 999 Total (i.e. Null);  997 Residual\nNull Deviance:\t    964 \nResidual Deviance: 797 \tAIC: 803\n```\n:::\n:::\n\nThis estimate for $A$ is a good estimate of the conditional effect in the population, based on the potential outcomes at each level of $L$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndtB[, .(LOR = log( odds( mean(Y1) ) / odds( mean(Y0) ) ) ), keyby = L]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   L   LOR\n1: 0 1.104\n2: 1 1.067\n```\n:::\n:::\n\n\n## Marginal effect\n\nThe marginal estimate is biased both for the conditional effect and the marginal causal effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmm<-glm(Y ~ A , data = dtB, family=\"binomial\")\nmm\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:  glm(formula = Y ~ A, family = \"binomial\", data = dtB)\n\nCoefficients:\n(Intercept)            A  \n      -2.33         1.59  \n\nDegrees of Freedom: 999 Total (i.e. Null);  998 Residual\nNull Deviance:\t    964 \nResidual Deviance: 876 \tAIC: 880\n```\n:::\n:::\n\n\n\n## Numerator and Denominator model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnumModel <- glm(A ~ 1, data = dtB, family = \"binomial\")\ndenModel <- glm(A ~ L, data = dtB, family = \"binomial\")\n```\n:::\n\n\n## Stabilized weights by hand\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndtB[, pA0 := predict(numModel, type = \"response\")]\ndtB[, pA := predict(denModel, type = \"response\")]\ndefB2 <- defDataAdd(varname = \"IPW\", \n                    formula = \"(A*pA0+(1-A)*(1-pA0))/((A * pA) + ((1 - A) * (1 - pA)))\", \n                    dist = \"nonrandom\")\ndtB <- addColumns(defB2, dtB)\ndtB[1:6]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   id L Y0 Y1 A Y   pA0     pA    IPW\n1:  1 0  0  0 0 0 0.423 0.3347 0.8673\n2:  2 0  0  1 0 0 0.423 0.3347 0.8673\n3:  3 1  0  0 1 0 0.423 0.6718 0.6297\n4:  4 0  0  0 0 0 0.423 0.3347 0.8673\n5:  5 1  1  1 0 1 0.423 0.6718 1.7578\n6:  6 1  0  0 1 0 0.423 0.6718 0.6297\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(dtB$IPW)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8673 0.6297 1.7578 1.2639\n```\n:::\n:::\n\n\n## Stabilized weights with **ipw** package\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempsw<-ipw::ipwpoint(exposure=A,family=\"binomial\",link=\"logit\",numerator=~1,denominator = ~L,data=dtB)\ntempw<-ipw::ipwpoint(exposure=A,family=\"binomial\",link=\"logit\",denominator = ~L,data=dtB)\nunique(tempsw$ipw.weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8673 0.6297 1.7578 1.2639\n```\n:::\n\n```{.r .cell-code}\nmean(tempsw$ipw.weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1\n```\n:::\n\n```{.r .cell-code}\nunique(tempw$ipw.weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.503 1.489 3.047 2.988\n```\n:::\n\n```{.r .cell-code}\nmean(tempw$ipw.weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2\n```\n:::\n:::\n\n\n\n## Applying IPW \n\n### Unstabilized weights\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mw<-glm(Y ~ A , data = dtB, family=\"binomial\", weights = tempw$ipw.weights))$coef\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in eval(family$initialize): non-integer #successes in a binomial glm!\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error z value  Pr(>|z|)\n(Intercept)   -2.069     0.1002 -20.645 1.076e-94\nA              1.081     0.1229   8.801 1.354e-18\n```\n:::\n:::\n\n\n### Stabilized weights\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mws<-glm(Y ~ A , data = dtB, family=\"binomial\", weights = tempsw$ipw.weights))$coef\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in eval(family$initialize): non-integer #successes in a binomial glm!\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error z value  Pr(>|z|)\n(Intercept)   -2.069     0.1319 -15.682 1.996e-55\nA              1.081     0.1713   6.312 2.760e-10\n```\n:::\n:::\n\n## Comparison\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary::modelsummary(models=list(\"marginal\"=mm,\"conditional\"=mc,\"IPW\"=mw,\"IPWs\"=mws))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in eval(family$initialize): non-integer #successes in a binomial glm!\n\nWarning in eval(family$initialize): non-integer #successes in a binomial glm!\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> marginal </th>\n   <th style=\"text-align:center;\"> conditional </th>\n   <th style=\"text-align:center;\">  IPW </th>\n   <th style=\"text-align:center;\">  IPWs </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> −2.333 </td>\n   <td style=\"text-align:center;\"> −2.736 </td>\n   <td style=\"text-align:center;\"> −2.069 </td>\n   <td style=\"text-align:center;\"> −2.069 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.147) </td>\n   <td style=\"text-align:center;\"> (0.165) </td>\n   <td style=\"text-align:center;\"> (0.100) </td>\n   <td style=\"text-align:center;\"> (0.132) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:center;\"> 1.587 </td>\n   <td style=\"text-align:center;\"> 1.211 </td>\n   <td style=\"text-align:center;\"> 1.081 </td>\n   <td style=\"text-align:center;\"> 1.081 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.180) </td>\n   <td style=\"text-align:center;\"> (0.191) </td>\n   <td style=\"text-align:center;\"> (0.123) </td>\n   <td style=\"text-align:center;\"> (0.171) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 1.614 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (0.183) </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 1000 </td>\n   <td style=\"text-align:center;\"> 1000 </td>\n   <td style=\"text-align:center;\"> 1000 </td>\n   <td style=\"text-align:center;\"> 1000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> AIC </td>\n   <td style=\"text-align:center;\"> 880.1 </td>\n   <td style=\"text-align:center;\"> 802.5 </td>\n   <td style=\"text-align:center;\"> 1847.3 </td>\n   <td style=\"text-align:center;\"> 1004.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BIC </td>\n   <td style=\"text-align:center;\"> 889.9 </td>\n   <td style=\"text-align:center;\"> 817.3 </td>\n   <td style=\"text-align:center;\"> 1857.1 </td>\n   <td style=\"text-align:center;\"> 1014.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Log.Lik. </td>\n   <td style=\"text-align:center;\"> −438.049 </td>\n   <td style=\"text-align:center;\"> −398.272 </td>\n   <td style=\"text-align:center;\"> −921.632 </td>\n   <td style=\"text-align:center;\"> −500.206 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:center;\"> 77.828 </td>\n   <td style=\"text-align:center;\"> 71.500 </td>\n   <td style=\"text-align:center;\"> 77.460 </td>\n   <td style=\"text-align:center;\"> 39.837 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 0.37 </td>\n   <td style=\"text-align:center;\"> 0.35 </td>\n   <td style=\"text-align:center;\"> 0.37 </td>\n   <td style=\"text-align:center;\"> 0.37 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\nWe used R version 4.3.2 [@base] and the following R packages: ipw v. 1.2 [@ipw], rio v. 0.5.26 [@rio], simstudy v. 0.7.1 [@simstudy].\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n   Package Version  Citation\n1     base   4.3.2     @base\n2      ipw     1.2      @ipw\n3      rio  0.5.26      @rio\n4 simstudy   0.7.1 @simstudy\n```\n:::\n:::\n\n\n\n\n\n# Bibliography {-}\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "noncollaps_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}